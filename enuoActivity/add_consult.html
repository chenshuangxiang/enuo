<!DOCTYPE html><html><head>	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />	<meta http-equiv="X-UA-Compatible" content="IE=edge">	<meta name="renderer" content="webkit">	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">	<link rel="stylesheet" href="css/basic.css" />	<link rel="stylesheet" href="css/add_consult.css" />	<title>添加咨询</title></head><body><div id="addConsult">	<div class="head">		<img src="img/min_logo.png" class="min_logo"/>		<img src="img/search.png" class="head_right search"/>	</div>	<div class="content">		<div class="content_form">			<form id="form_filter_option" class="form">				<div class="form_head">					<span class="form_head_green">筛查选项</span>					<span class="form_head_red">*(必填)</span><br />					<input class="form_head_btn_red" id="add_consult_save" type="button" value="保存" style="width: 60px;right: 90px;"/>					<input class="form_head_btn" type="reset" value="重置" style="width: 60px;"/>				</div>				<div class="form_input ">					<span>患者姓名</span><span style="color: red;">*(必填)</span><br />					<input type="text" class="patientName"/>				</div>				<div class="form_input ">					<span>联系电话</span><span style="color: red;">*(必填)</span><br />					<input type="text" class="phone"/>				</div>				<div class="form_input ">					<span>患者年龄</span><br />					<input type="text" class="patient_age"/>				</div>				<div class="form_input hos_none">					<span>咨询医院</span><span style="color: red;">*(必填)</span><br />					<select  class="consult_hospital">						<option value="0">请选择医院</option>					</select>				</div>				<div class="form_input">					<span>预约科室</span><span style="color: red;">*(必填)</span><br />					<select class="ill_office">						<option value="0">请选择科室</option>					</select>				</div>				<div class="form_input ">					<span>咨询病种</span><br />					<input type="text" class="consult_entity"/>				</div>				<div class="form_input ">					<span>咨询时间</span><span style="color: red;">*(必填)</span><br />					<input type="text" class="Wdate consult_time" onfocus="WdatePicker({lang:'zh-cn',dateFmt: 'yyyy-MM-dd HH:mm:ss',maxDate:new Date()})" />				</div>				<div class="form_input ">					<span>地址</span><br />					<input type="text" class="address"/>				</div>				<div class="form_input ">					<span>QQ\微信\邮箱</span><br />					<input type="text" class="contact"/>				</div>				<div class="form_input">					<span>来源</span><span style="color: red;">*(必填)</span><br />					<select  class="form_select consult_path">						<option value="0">请选择</option>					</select>				</div>				<div class="form_input">					<span>意向医院</span><br />					<select class="form_select intere_hospital">						<option value="0">请选择意向医院</option>					</select>				</div>				<div class="form_input hos_none">					<span>预约医院</span><br />					<select  class="form_select make_hospital">						<option value="0">请选择预约医院</option>					</select>				</div>				<div class="form_input ">					<span>预约医生姓名</span><br />					<input type="text" class="make_doctor" />				</div>				<div class="form_input ">					<span>预约医生时间</span><br />					<input type="text" class="Wdate make_time" onfocus="WdatePicker({lang:'zh-cn',dateFmt: 'yyyy-MM-dd HH:mm:ss',maxDate:new Date()})"/>				</div>				<div class="form_input ">					<span>预约医生电话</span><br />					<input type="text" class="doctor_phone"/>				</div>				<div class="form_input" style="height: 120px;">					<span>患者需求</span><br />					<textarea class="entity_need" rows="5" style="width: 96%;">这是一个文本域</textarea>				</div>			</form>		</div>	</div>		<!--底部-->	<div class="bottom">		<div class="bottom_left" onclick="window.location.href='add_consult.html'">			<img src="img/add_consult.png" class="bottom_left_img"/><br />			<span class="bottom_left_span">添加咨询</span>		</div>		<div class="bottom_right" onclick="window.location.href='all_consult.html'">			<img src="img/all_consult.png" class="bottom_right_img" /><br />			<span class="bottom_right_span">全部咨询</span>		</div>	</div></div><script type="text/javascript" src="../plug/jquery-1.11.3.js" ></script><script type="text/javascript" src="../plug/template-web.js" ></script><!--日期插件--><link rel="stylesheet" href="../plug/My97DatePicker/skin/WdatePicker.css" /><script src="../plug/My97DatePicker/WdatePicker.js"></script><script type="text/javascript" src="js/h5_util.js"></script><script type="text/javascript" src="js/method.js" ></script><script id="test_hos" type="text/html">	<!--医院列表-->	{{each hosps value}}		<option value="{{value.id}}">			{{value.name}}		</option>	{{/each}}</script><script id="test_way" type="text/html">	<!--咨询路径-->	{{each ways value}}		<option value="{{value.id}}">			{{value.name}}		</option>	{{/each}}</script><!--预约科室--><script id="test_ill_office" type="text/html">	{{each data value}}		<option value="{{value.id}}">			{{value.departmentname}}		</option>	{{/each}}</script><script type="text/javascript">    function getNowFormatDate() {        var date = new Date();        var seperator1 = "-";        var seperator2 = ":";        var month = date.getMonth() + 1;        var strDate = date.getDate();        if (month >= 1 && month <= 9) {            month = "0" + month;        }        if (strDate >= 0 && strDate <= 9) {            strDate = "0" + strDate;        }        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate            + " " + date.getHours() + seperator2 + date.getMinutes()            + seperator2 + date.getSeconds();        return currentdate;    }$(function(){	$('.consult_time').val(getNowFormatDate());	//初始化select模板	$.get(url+"/consultComps",function(data){		console.log(data);		//绑定模板		//咨询医院		var html = template('test_hos',data.data);		$(".consult_hospital").append(html);		//意向医院		var html = template('test_hos',data.data);		$(".intere_hospital").append(html);		//预约医院		var html = template('test_hos',data.data);		$(".make_hospital").append(html);		//咨询路径		var html = template('test_way',data.data);		$(".consult_path").append(html);			});	$.get(url+"/sectionOffices",function(data){		//预约科室		var html = template('test_ill_office',data);		$(".ill_office").append(html);	});});$(function(){	if(getRole() == 100){		$(".hos_none").hide();	}});</script><!--提交--><script type="text/javascript">$(function(){	//命名select属性值变量	var consult_hospital="";	var consult_hospital_id=0;	var consult_path=0;	var consult_entity="";//	var consult_entity_id=0;	var intere_hospital="";	var intere_hospital_id=0	var make_hospital_id=0;	var ill_office_id =0;	var ill_office ="";	var patient_age = 0;	//获取selecr的val值	$(".consult_hospital").change(function(){		consult_hospital_id = $(".consult_hospital").val();		consult_hospital = $(".consult_hospital").find("option:selected").text().trim();//trim去前后所有空格		console.log(consult_hospital_id);	});	$(".consult_path").change(function(){		consult_path = $(".consult_path").val();		console.log(consult_path);	});	$(".ill_office").change(function(){		ill_office_id = $(".ill_office").val();		ill_office = $(".ill_office").find("option:selected").text().trim();//trim去前后所有空格		console.log(ill_office_id);	});	$(".intere_hospital").change(function(){		intere_hospital_id = $(".intere_hospital").val();		intere_hospital = $(".intere_hospital").find("option:selected").text().trim();//trim去前后所有空格		console.log(intere_hospital_id);	});		$(".make_hospital").change(function(){		make_hospital_id = $(".make_hospital").val();		console.log(make_hospital_id);	});		//表单提交	$("#add_consult_save").click(function(){		//基本信息输入框		var patientName = $(".patientName").val();		patient_age = $(".patient_age").val();		if(!regZeroNum(patient_age)){			patient_age = 0;		}		var phone = $(".phone").val();		var address = $(".address").val();		var contact = $(".contact").val();		var consult_time = $(".consult_time").val();		consult_entity = $(".consult_entity").val();				var make_doctor = $(".make_doctor").val();		var make_time = $(".make_time").val();		var doctor_phone = $(".doctor_phone").val();		var entity_need = $(".entity_need").val();		//请求数据		var data = {			"customer": patientName,		    "mobile": phone,		    "age":patient_age,		    "address": address,		    "contact": contact,		    "consultHos": consult_hospital,    		"consultHosId": consult_hospital_id,		    "consultWay": consult_path,		    "departmentId":ill_office_id,		    "department":ill_office,		    "ill": consult_entity,    		"intentHos":intere_hospital,		    "intentHosId": intere_hospital_id,		    "consultTime":consult_time,		    		    "reservationHosId": make_hospital_id,		    "reservationDocMobile": doctor_phone,		    "reservationDocTime": make_time,		    "reservationDocName": make_doctor,		    "customerRequirement":entity_need,		    "role":getRole()		}		console.log(data);		//必填信息的输入框验证		if(patientName == "" || phone == ""  || consult_time == ""){			alert("输入不能为空");			return false;		}		//必选项的下拉选验证		if(getRole()==1){			//角色是员工下的验证			if(!regNum(consult_hospital_id) || !regNum(ill_office_id) || !regNum(consult_path)){				alert("下拉选不能为空");				return false;			}		}else if(getRole()==100){			//角色是医院下的验证			if(!regNum(consult_path)){				alert("下拉选不能为空");				return false;			}		}		$.post(url+"/addConsult",data,function(data){//				console.log(data);			if(data.code == 0){				alert("添加成功");			}else{				alert(data.msg);			}		});			});});</script></body></html>