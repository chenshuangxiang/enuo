<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>大转盘活动</title><link href="css/rotor.css" rel="stylesheet" type="text/css"><script type="text/javascript" src="js/jquery-1.11.3.js"></script><script type="text/javascript" src="js/lib/awardRotate.js"></script><script type="text/javascript" src="js/viewport.js"></script><script type="text/javascript">//用户名var nickName ="";var flag="";var turnplate={		restaraunts:[],				//大转盘奖品名称		colors:[],					//大转盘奖品区块对应背景颜色		outsideRadius:170,			//大转盘外圆的半径		textRadius:130,				//大转盘奖品位置距离圆心的距离		insideRadius:55,			//大转盘内圆的半径		startAngle:0,				//开始角度		bRotate:false				//false:停止;ture:旋转};$(document).ready(function(){	//动态添加大转盘的奖品与奖品区域背景颜色	turnplate.restaraunts = ["无针水光针","水氧美人","洁牙","超声刀", "进口玻尿酸", "保妥适瘦脸针", "面部除皱(一个部位)","谢谢惠顾"];	turnplate.colors = ["#a5da35", "#96eaea", "#50c2ee", "#a5da35","#96eaea", "#a5da35", "#50c2ee","#96eaea"];	var rotateTimeOut = function (){		$('#wheelcanvas').rotate({			angle:0,			animateTo:2160,			duration:8000,			callback:function (){				alert('网络超时，请检查您的网络设置！');			}		});	};	//旋转转盘 item:奖品位置; txt：提示语;	var rotateFn = function (item, txt){		var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));		if(angles<270){			angles = 270 - angles;		}else{			angles = 360 - angles + 270;		}		$('#wheelcanvas').stopRotate();		$('#wheelcanvas').rotate({			angle:0,			animateTo:angles+3600,			duration:7000, //转盘速度			callback:function (){				//利用对话框返回true或者false//				if(confirm("恭喜您抽中了一张:"+txt+"免费券，确认领取吗?")){//					if(txt){//						var data ={//							"nickname":nickName,//							"luckygoods":txt//						}//						alert(JSON.stringify(data));//						$.post("http://47.95.254.125:8080/enuoact/saveluckyInfo",data,function(res){//							if(res.code==0){//								alert("成功了"+res.msg);//							}else{//							alert("失败了"+res.msg);//							}////						});//					}//				}else{//					alert("按了取消按钮后，系统返回false");//				}			alert("恭喜您抽中了:"+txt+"免费套餐");				turnplate.bRotate = !turnplate.bRotate;			}		});	};	$('.pointer').click(function (){				$.post("http://127.0.0.1/app/activity/luckyWeel",'',function(res){				    console.log(res)                    res = JSON.parse(res);					if(res.success){                            for (var i = 0; i < turnplate.restaraunts.length; i++) {                                console.log(res.data)                                if (turnplate.restaraunts[i] == res.data) {                                    //alert("奖品结果的下标"+i);                                    var item = i;                                    if (turnplate.bRotate) return;                                    turnplate.bRotate = !turnplate.bRotate;                                    //奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]                                    console.log(item + "," + turnplate.restaraunts[item]);                                    rotateFn(item + 1, turnplate.restaraunts[item]);                                }                            }					}else{						console.log("失败了"+res.msg);					}				});	});});//function rnd(){//	//turnplate.restaraunts = ["无针水光针","水氧美人","洁牙","超声刀", "进口玻尿酸", "保妥适瘦脸针", "面部除皱(一个部位)"];//	//水氧美人 45%  水光针 45%   洁牙  10%//	var arr=["1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","3","3"];//	var random = Math.floor(Math.random()*21);////	console.log("random:"+random);////	console.log(arr[random]);//	return arr[random];////}//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染window.onload=function(){	drawRouletteWheel();};function drawRouletteWheel() {  var canvas = document.getElementById("wheelcanvas");  if (canvas.getContext) {	  //根据奖品个数计算圆周角度	  var arc = Math.PI / (turnplate.restaraunts.length/2);	  var ctx = canvas.getContext("2d");	  //在给定矩形内清空一个矩形	  ctx.clearRect(0,0,400,400);	  //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式	  ctx.strokeStyle = "#FFBE04";	  //font 属性设置或返回画布上文本内容的当前字体属性	  ctx.font = '16px Microsoft YaHei';	  for(var i = 0; i < turnplate.restaraunts.length; i++) {		  var angle = turnplate.startAngle + i * arc;		  ctx.fillStyle = turnplate.colors[i];		  ctx.beginPath();		  //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）		  ctx.arc(200, 200, turnplate.outsideRadius, angle, angle + arc, false);		  ctx.arc(200, 200, turnplate.insideRadius, angle + arc, angle, true);		  ctx.stroke();		  ctx.fill();		  //锁画布(为了保存之前的画布状态)		  ctx.save();		  //----绘制奖品开始----		  ctx.fillStyle = "#E5302F";		  var text = turnplate.restaraunts[i];		  var line_height = 17;		  //translate方法重新映射画布上的 (0,0) 位置		  ctx.translate(200 + Math.cos(angle + arc / 2) * turnplate.textRadius, 200 + Math.sin(angle + arc / 2) * turnplate.textRadius);		  //rotate方法旋转当前的绘图		  ctx.rotate(angle + arc / 2 + Math.PI / 2);		  /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/		  if(text.indexOf("M")>0){//流量包			  var texts = text.split("M");			  for(var j = 0; j<texts.length; j++){				  ctx.font = j == 0?'bold 20px Microsoft YaHei':'16px Microsoft YaHei';				  if(j == 0){					  ctx.fillText(texts[j]+"M", -ctx.measureText(texts[j]+"M").width / 2, j * line_height);				  }else{					  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);				  }			  }		  }else if(text.indexOf("M") == -1 && text.length>6){//奖品名称长度超过一定范围			  text = text.substring(0,6)+"||"+text.substring(6);			  var texts = text.split("||");			  for(var j = 0; j<texts.length; j++){				  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);			  }		  }else{			  //在画布上绘制填色的文本。文本的默认颜色是黑色			  //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度			  ctx.fillText(text, -ctx.measureText(text).width / 2, 0);		  }		  //添加对应图标		  if(text.indexOf("闪币")>0){			  var img= document.getElementById("shan-img");			  img.onload=function(){				  ctx.drawImage(img,-15,10);			  };			  ctx.drawImage(img,-15,10);		  }else if(text.indexOf("谢谢参与")>=0){			  var img= document.getElementById("sorry-img");			  img.onload=function(){				  ctx.drawImage(img,-15,10);			  };			  ctx.drawImage(img,-15,10)		  }		  //把当前画布返回（调整）到上一个save()状态之前		  ctx.restore();		  //----绘制奖品结束----	  }  }}</script></head><body style="">    <!--<div>    </div>-->    <img src="img/rotor/1.png" id="shan-img" style="display:none;" />    <img src="img/rotor/2.png" id="sorry-img" style="display:none;" />	<div class="banner">		<div class="turnplate" style="background-image:url(img/rotor/turnplate-bg.png);background-size:100% 100%;">			<canvas class="item" id="wheelcanvas" width="400px" height="400px"></canvas>			<img class="pointer" src="img/rotor/turnplate-pointer.png"/>		</div>	</div>	<!--规则说明-->	<!--<div class="activity_explain">		<div class="transition">					</div>			</div>--></body></html>